#!/bin/bash

# Get the directory of this script
SCRIPT_DIR=$(realpath "${BASH_SOURCE[0]%/*}")
BUILD_ROOT=$(realpath "$SCRIPT_DIR/..")

ARCH_DIR="$BUILD_ROOT/x86_64"
DB_FILE="$ARCH_DIR/omarchy.db.tar.zst"

if [[ ! -f "$DB_FILE" ]]; then
    echo "Repository database not found"
    exit 1
fi

# Extract package names and versions from database
tar -xOf "$DB_FILE" --wildcards "*/desc" 2>/dev/null | 
    awk '/%NAME%/{getline; name=$0} 
         /%VERSION%/{getline; print name "-" $0}' | 
    sort